<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; connect-src 'self' https: wss: http:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https: blob:;">
    <title>ë™ì›ê³¼ê¸°ëŒ€ AI ì…í•™ìƒë‹´ v6.51</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --dist-blue: #1a3a5c;
            --dist-red: #CC0000;
            --dist-gold: #B8860B;
            --dist-gray: #666666;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--dist-blue) 0%, var(--dist-red) 50%, var(--dist-gold) 100%);
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        /* ========== ìƒë‹¨ í—¤ë” (7%) ========== */
        .header {
            height: 7%;
            min-height: 48px;
            max-height: 55px;
            background: white;
            padding: 0 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .logo-area {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .logo-dist {
            font-size: 20px;
            font-weight: 900;
            letter-spacing: -1px;
            display: flex;
        }
        
        .logo-d { color: var(--dist-blue); }
        .logo-i { color: var(--dist-red); }
        .logo-s { color: var(--dist-blue); }
        .logo-t { color: var(--dist-blue); }
        
        .logo-arrow {
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-bottom: 7px solid var(--dist-gold);
            transform: rotate(-30deg);
            margin-left: 2px;
            margin-top: -5px;
        }
        
        .header-right {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        
        .language-selector {
            padding: 5px 10px;
            border: 2px solid var(--dist-blue);
            border-radius: 12px;
            background: white;
            color: var(--dist-blue);
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
        }
        
        .consult-request-btn {
            background: linear-gradient(135deg, var(--dist-red), #990000);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            cursor: pointer;
            border: none;
        }
        
        /* ========== ì–¸ì–´ ëª¨ë‹¬ ========== */
        .language-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .language-modal.active {
            display: flex;
        }
        
        .language-options {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 90%;
            width: 300px;
        }
        
        .language-options h3 {
            text-align: center;
            margin-bottom: 15px;
            color: var(--dist-blue);
        }
        
        .language-option {
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .language-option:hover {
            border-color: var(--dist-blue);
            background: #f0f7ff;
        }
        
        .language-option.selected {
            border-color: var(--dist-blue);
            background: linear-gradient(135deg, var(--dist-blue), #0d2840);
            color: white;
        }
        
        .language-flag {
            font-size: 1.5em;
            margin-right: 8px;
        }
        
        /* ========== ìƒë‹´ ëª¨ë‹¬ ========== */
        .consult-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .consult-modal.active {
            display: flex;
        }
        
        .consult-form {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 95%;
            width: 380px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .consult-form h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dist-blue);
            font-size: 1.2em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--dist-blue);
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .form-buttons button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        
        .submit-consult {
            background: linear-gradient(135deg, var(--dist-red), #990000);
            color: white;
        }
        
        .cancel-consult {
            background: #e5e7eb;
            color: #374151;
        }
        
        /* ========== ë©”ì¸ ì»¨í…Œì´ë„ˆ ========== */
        .chat-container {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 6px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        /* ========== AI ì…í•™ìƒë‹´ íƒ€ì´í‹€ (6%) ========== */
        .chat-header {
            height: 6%;
            min-height: 42px;
            max-height: 50px;
            background: linear-gradient(135deg, var(--dist-blue) 0%, var(--dist-red) 50%, var(--dist-gold) 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .chat-header h1 {
            font-size: 1em;
        }
        
        .chat-header .version {
            font-size: 0.65em;
            opacity: 0.8;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* ========== ì±„íŒ… ì˜ì—­ (75% - flex:1) ========== */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: #f7f9fc;
        }
        
        .message {
            margin-bottom: 12px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            display: flex;
            justify-content: flex-start;
        }
        
        .user-message {
            display: flex;
            justify-content: flex-end;
        }
        
        .message-content {
            max-width: 85%;
            padding: 12px 15px;
            border-radius: 15px;
            line-height: 1.6;
            word-wrap: break-word;
            font-size: 0.9em;
        }
        
        .bot-message .message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, var(--dist-blue), #0d2840);
            color: white;
        }
        
        /* ì „í™”ë²ˆí˜¸ ë§í¬ - í„°ì¹˜ ì‹œ ì»¤ì§€ëŠ” íš¨ê³¼ */
        .message-content a {
            color: var(--dist-blue);
            text-decoration: none;
            font-weight: bold;
            transition: all 0.15s ease;
            display: inline-block;
        }
        
        .message-content a:hover,
        .message-content a:active {
            font-size: 1.15em;
            color: var(--dist-red);
        }
        
        /* ========== ì…ë ¥ ì˜ì—­ (7%) ========== */
        .chat-input-area {
            height: 7%;
            min-height: 50px;
            max-height: 60px;
            padding: 8px 12px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }
        
        .chat-input:focus {
            border-color: var(--dist-blue);
        }
        
        .send-button {
            padding: 10px 22px;
            background: linear-gradient(135deg, var(--dist-blue), #0d2840);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
        }
        
        .send-button:active {
            transform: scale(0.95);
        }
        
        .send-button:disabled {
            opacity: 0.5;
        }
        
        /* ========== í•˜ë‹¨ í‘¸í„° (5%) ========== */
        .footer {
            height: 5%;
            min-height: 32px;
            max-height: 40px;
            background: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            border-top: 1px solid #eee;
            flex-shrink: 0;
        }
        
        .footer-link {
            font-size: 0.7em;
            color: var(--dist-blue);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.15s ease;
        }
        
        .footer-link:hover,
        .footer-link:active {
            color: var(--dist-red);
            font-size: 0.8em;
        }
        
        .footer-divider {
            color: #ccc;
            font-size: 0.7em;
        }
        
        /* ========== ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ========== */
        .loading {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--dist-blue);
            animation: loading 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        
        .loading:nth-child(1) { animation-delay: -0.32s; }
        .loading:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” */
        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ í—¤ë” (7%) -->
    <div class="header">
        <div class="logo-area">
            <div class="logo-dist">
                <span class="logo-d">D</span>
                <span class="logo-i">I</span>
                <span class="logo-s">S</span>
                <span class="logo-t">T</span>
            </div>
            <div class="logo-arrow"></div>
        </div>
        <div class="header-right">
            <button class="language-selector" id="languageBtn">ğŸŒ í•œêµ­ì–´</button>
            <button class="consult-request-btn" onclick="openConsultModal()">ğŸ“‹ í•™ê³¼ìƒë‹´ìš”ì²­</button>
        </div>
    </div>
    
    <!-- ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ -->
    <div class="language-modal" id="languageModal">
        <div class="language-options">
            <h3>Select Language</h3>
            <div class="language-option selected" data-lang="ko">
                <span class="language-flag">ğŸ‡°ğŸ‡·</span>
                <span>í•œêµ­ì–´ (Korean)</span>
            </div>
            <div class="language-option" data-lang="en">
                <span class="language-flag">ğŸ‡ºğŸ‡¸</span>
                <span>English</span>
            </div>
            <div class="language-option" data-lang="zh">
                <span class="language-flag">ğŸ‡¨ğŸ‡³</span>
                <span>ä¸­æ–‡ (Chinese)</span>
            </div>
            <div class="language-option" data-lang="vi">
                <span class="language-flag">ğŸ‡»ğŸ‡³</span>
                <span>Tiáº¿ng Viá»‡t (Vietnamese)</span>
            </div>
            <div class="language-option" data-lang="ja">
                <span class="language-flag">ğŸ‡¯ğŸ‡µ</span>
                <span>æ—¥æœ¬èª (Japanese)</span>
            </div>
            <div class="language-option" data-lang="uz">
                <span class="language-flag">ğŸ‡ºğŸ‡¿</span>
                <span>O'zbek (Uzbek)</span>
            </div>
            <div class="language-option" data-lang="bn">
                <span class="language-flag">ğŸ‡§ğŸ‡©</span>
                <span>à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)</span>
            </div>
        </div>
    </div>
    
    <!-- ìƒë‹´ ëª¨ë‹¬ -->
    <div class="consult-modal" id="consultModal">
        <div class="consult-form">
            <h3 id="consultTitle">ğŸ“‹ í•™ê³¼ ìƒë‹´ì‹ ì²­</h3>
            <div class="form-group">
                <label id="consultNameLabel">ì´ë¦„ *</label>
                <input type="text" id="consultName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <div class="form-group">
                <label id="consultPhoneLabel">ì—°ë½ì²˜ *</label>
                <input type="tel" id="consultPhone" placeholder="010-1234-5678" required>
            </div>
            <div class="form-group">
                <label id="consultDeptLabel">ê´€ì‹¬ í•™ê³¼ *</label>
                <select id="consultDept" required>
                    <option value="" id="consultDeptPlaceholder">í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    <optgroup label="ë³´ê±´í•™ë¶€">
                        <option value="ê°„í˜¸í•™ê³¼">ê°„í˜¸í•™ê³¼</option>
                        <option value="ì•ˆê²½ê´‘í•™ê³¼">ì•ˆê²½ê´‘í•™ê³¼</option>
                        <option value="ë³´ê±´ì˜ë£Œí–‰ì •ê³¼">ë³´ê±´ì˜ë£Œí–‰ì •ê³¼</option>
                    </optgroup>
                    <optgroup label="í•­ê³µëª¨ë¹Œë¦¬í‹°í•™ë¶€">
                        <option value="í•­ê³µì •ë¹„ê³¼">í•­ê³µì •ë¹„ê³¼(3ë…„ì œ)</option>
                        <option value="í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)">í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)</option>
                    </optgroup>
                    <optgroup label="ì²¨ë‹¨ê³µí•™ë¶€">
                        <option value="ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼">ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼</option>
                        <option value="ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼">ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼</option>
                        <option value="AIê¸°ê³„ì œì–´ê³¼">AIê¸°ê³„ì œì–´ê³¼</option>
                        <option value="ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼">ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼</option>
                        <option value="ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼">ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼</option>
                    </optgroup>
                    <optgroup label="í˜¸í…”ì¡°ë¦¬ê´€ê´‘í•™ë¶€">
                        <option value="í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼">í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼</option>
                        <option value="ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)">ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)</option>
                        <option value="ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼">ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼</option>
                        <option value="í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼">í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼</option>
                    </optgroup>
                    <optgroup label="ë¯¸ìš©ì˜ˆìˆ í•™ë¶€">
                        <option value="í—¤ì–´ë””ìì¸ê³¼">í—¤ì–´ë””ìì¸ê³¼</option>
                        <option value="ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼">ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼</option>
                    </optgroup>
                    <optgroup label="ìŠ¤í¬ì¸ ì¬í™œí•™ë¶€">
                        <option value="ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼">ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼</option>
                        <option value="ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼">ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼</option>
                    </optgroup>
                    <optgroup label="ì¸ë¬¸ì‚¬íšŒí•™ë¶€">
                        <option value="ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)">ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)</option>
                        <option value="ì‚¬íšŒë³µì§€ê³¼">ì‚¬íšŒë³µì§€ê³¼</option>
                        <option value="ë³´ê±´ë³µì§€ê³¼">ë³´ê±´ë³µì§€ê³¼</option>
                    </optgroup>
                    <optgroup label="ì¼ë°˜ìƒë‹´">
                        <option value="ì…í•™í™ë³´ì²˜">ì…í•™í™ë³´ì²˜</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group">
                <label id="consultMessageLabel">ë¬¸ì˜ë‚´ìš© (ì„ íƒ)</label>
                <input type="text" id="consultMessage" placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”">
            </div>
            <div class="form-buttons">
                <button class="cancel-consult" id="cancelBtn" onclick="closeConsultModal()">ì·¨ì†Œ</button>
                <button class="submit-consult" id="submitBtn" onclick="submitConsult()">ìƒë‹´ì‹ ì²­</button>
            </div>
        </div>
    </div>
    
    <!-- ë©”ì¸ ì±„íŒ… ì»¨í…Œì´ë„ˆ -->
    <div class="chat-container">
        <!-- AI ì…í•™ìƒë‹´ íƒ€ì´í‹€ (6%) -->
        <div class="chat-header">
            <h1 id="chatTitle">ğŸ¤– AI ì…í•™ìƒë‹´</h1>
            <span class="version">v6.51</span>
        </div>

        <!-- ì±„íŒ… ì˜ì—­ (75%) -->
        <div class="chat-messages" id="chatMessages"></div>
        
        <!-- ì…ë ¥ ì˜ì—­ (7%) - ìƒë‹´ë²„íŠ¼ ì‚­ì œë¨ -->
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="userInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
            <button class="send-button" id="sendButton">ì „ì†¡</button>
        </div>
    </div>
    
    <!-- í•˜ë‹¨ í‘¸í„° (5%) -->
    <div class="footer">
        <a href="tel:055-370-8226" class="footer-link">ğŸ“ ì…í•™ì²˜ 055-370-8226~8</a>
        <span class="footer-divider">|</span>
        <a href="https://www.dist.ac.kr" class="footer-link" target="_blank">ğŸ  í™ˆí˜ì´ì§€</a>
    </div>

    <script>
        // ========================================
        // âœ… ì„¤ì •: Gemini API ì§ì ‘ ì—°ê²°
        // ========================================
        const GEMINI_API_KEY = 'AIzaSyBP0u0GfGWt2RUT9C6kxzJpQmsN8AEnnL4';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
        
        // í•™ê³¼ë³„ ìƒë‹´êµìˆ˜ ì •ë³´
        const PROFESSORS = {
            'ê°„í˜¸í•™ê³¼': { name: 'ê¹€ì†¡ìˆœ', phone: '010-4662-6209', office: '055-370-8243' },
            'ì•ˆê²½ê´‘í•™ê³¼': { name: 'ìœ¤ë¯¸ì˜¥', phone: '010-8931-7214', office: '055-370-8214' },
            'ë³´ê±´ì˜ë£Œí–‰ì •ê³¼': { name: 'ì´ìŠ¹ì¬', phone: '010-5895-4862', office: '055-370-8197' },
            'í•­ê³µì •ë¹„ê³¼': { name: 'ë°°ê·œí•œ', phone: '010-6511-5235', office: '055-370-8318' },
            'í•­ê³µì •ë¹„ê³¼(ì•¼ê°„)': { name: 'ê¹€ì„±ìš°', phone: '010-5626-5877', office: '055-370-8311' },
            'ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼': { name: 'ì´í•™ì›', phone: '010-3680-9833', office: '055-370-8371' },
            'ì„ ë°•ë™ë ¥ê¸°ê³„ê³¼': { name: 'ë°•ì§€ì–¸', phone: '010-6585-3163', office: '055-370-8290' },
            'AIê¸°ê³„ì œì–´ê³¼': { name: 'ì´í•™ì›', phone: '010-3680-9833', office: '055-370-8371' },
            'ëƒ‰ë™ê³µì¡°ì„¤ë¹„ê³¼': { name: 'ì´ì •í˜„', phone: '010-8569-8819', office: '055-370-8167' },
            'ì‚°ì—…ì•ˆì „ê´€ë¦¬ê³¼': { name: 'ê³ ê²½ì°¬', phone: '010-4570-6993', office: '055-370-8195' },
            'í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼': { name: 'ì¥ìš©í˜„', phone: '010-4561-2259', office: '055-370-8146' },
            'ì™¸ì‹ì¡°ë¦¬ì°½ì—…ê³¼(ì•¼ê°„)': { name: 'ì¥ìš©í˜„', phone: '010-4561-2259', office: '055-370-8146' },
            'ë””ì €íŠ¸ì¹´í˜ì°½ì—…ê³¼': { name: 'êµ¬ì˜ë•', phone: '010-5531-8283', office: '055-370-8283' },
            'í˜¸í…”ì‹í’ˆì œê³¼ì œë¹µê³¼': { name: 'ì •ë™ìœ¤', phone: '010-3698-3835', office: '055-370-8140' },
            'í—¤ì–´ë””ìì¸ê³¼': { name: 'ìœ¤ëŒ€ìˆ˜', phone: '010-4097-4747', office: '055-370-8184' },
            'ìœ ì•„êµìœ¡ê³¼(3ë…„ì œ)': { name: 'í•˜ì •ì—°', phone: '010-7582-0037', office: '055-370-8136' },
            'ì‚¬íšŒë³µì§€ê³¼': { name: 'ì¡°ì¬í•„', phone: '010-6513-0697', office: '055-370-8279' },
            'ë³´ê±´ë³µì§€ê³¼': { name: 'ì´ì„ ì°¬', phone: '010-2568-8367', office: '055-370-8198' },
            'ìŠ¤í¬ì¸ ì¬í™œìš´ë™ê³¼': { name: 'ì¡°ì˜ê°‘', phone: '010-8818-5511', office: '055-370-8270' },
            'ì „ë¬¸ìŠ¤í¬ì¸ ì§€ë„ê³¼': { name: 'ì¡°ì˜ê°‘', phone: '010-8818-5511', office: '055-370-8270' },
            'ìƒí™œë¬¸í™”ì˜ˆìˆ ê³¼': { name: 'ê³ ì˜í˜¸', phone: '010-2585-0206', office: '055-370-8192' },
            'ì…í•™í™ë³´ì²˜': { name: 'ì…í•™í™ë³´ì²˜', phone: '055-370-8226', office: '055-370-8226' }
        };
        
        const UI_TRANSLATIONS = {
            ko: { chatTitle: 'ğŸ¤– AI ì…í•™ìƒë‹´', inputPlaceholder: 'ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...', sendButton: 'ì „ì†¡', languageButton: 'ğŸŒ í•œêµ­ì–´' },
            en: { chatTitle: 'ğŸ¤– AI Admissions', inputPlaceholder: 'Type your question...', sendButton: 'Send', languageButton: 'ğŸŒ English' },
            zh: { chatTitle: 'ğŸ¤– AI å…¥å­¦å’¨è¯¢', inputPlaceholder: 'è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...', sendButton: 'å‘é€', languageButton: 'ğŸŒ ä¸­æ–‡' },
            vi: { chatTitle: 'ğŸ¤– TÆ° váº¥n AI', inputPlaceholder: 'Nháº­p cÃ¢u há»i...', sendButton: 'Gá»­i', languageButton: 'ğŸŒ Tiáº¿ng Viá»‡t' },
            ja: { chatTitle: 'ğŸ¤– AIå…¥å­¦ç›¸è«‡', inputPlaceholder: 'è³ªå•ã‚’å…¥åŠ›...', sendButton: 'é€ä¿¡', languageButton: 'ğŸŒ æ—¥æœ¬èª' },
            uz: { chatTitle: 'ğŸ¤– AI maslahat', inputPlaceholder: 'Savol kiriting...', sendButton: 'Yuborish', languageButton: "ğŸŒ O'zbek" },
            bn: { chatTitle: 'ğŸ¤– AI à¦ªà¦°à¦¾à¦®à¦°à§à¦¶', inputPlaceholder: 'à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨...', sendButton: 'à¦ªà¦¾à¦ à¦¾à¦¨', languageButton: 'ğŸŒ à¦¬à¦¾à¦‚à¦²à¦¾' }
        };
        
        const CONSULT_FORM_TEXT = {
            ko: { title: "ğŸ“‹ í•™ê³¼ ìƒë‹´ì‹ ì²­", nameLabel: "ì´ë¦„ *", namePlaceholder: "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”", phoneLabel: "ì—°ë½ì²˜ *", phonePlaceholder: "010-1234-5678", deptLabel: "ê´€ì‹¬ í•™ê³¼ *", deptPlaceholder: "í•™ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”", messageLabel: "ë¬¸ì˜ë‚´ìš© (ì„ íƒ)", messagePlaceholder: "ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”", cancelBtn: "ì·¨ì†Œ", submitBtn: "ìƒë‹´ì‹ ì²­" },
            en: { title: "ğŸ“‹ Consultation", nameLabel: "Name *", namePlaceholder: "Enter name", phoneLabel: "Phone *", phonePlaceholder: "010-1234-5678", deptLabel: "Department *", deptPlaceholder: "Select department", messageLabel: "Inquiry (Optional)", messagePlaceholder: "Brief description", cancelBtn: "Cancel", submitBtn: "Submit" },
            zh: { title: "ğŸ“‹ å’¨è¯¢ç”³è¯·", nameLabel: "å§“å *", namePlaceholder: "è¯·è¾“å…¥å§“å", phoneLabel: "è”ç³»æ–¹å¼ *", phonePlaceholder: "010-1234-5678", deptLabel: "ä¸“ä¸š *", deptPlaceholder: "è¯·é€‰æ‹©ä¸“ä¸š", messageLabel: "å’¨è¯¢å†…å®¹ï¼ˆå¯é€‰ï¼‰", messagePlaceholder: "ç®€è¦è¯´æ˜", cancelBtn: "å–æ¶ˆ", submitBtn: "æäº¤" },
            vi: { title: "ğŸ“‹ TÆ° váº¥n", nameLabel: "Há» tÃªn *", namePlaceholder: "Nháº­p tÃªn", phoneLabel: "Sá»‘ ÄT *", phonePlaceholder: "010-1234-5678", deptLabel: "Khoa *", deptPlaceholder: "Chá»n khoa", messageLabel: "Ná»™i dung", messagePlaceholder: "MÃ´ táº£ ngáº¯n", cancelBtn: "Há»§y", submitBtn: "Gá»­i" },
            ja: { title: "ğŸ“‹ ç›¸è«‡ç”³è«‹", nameLabel: "ãŠåå‰ *", namePlaceholder: "åå‰ã‚’å…¥åŠ›", phoneLabel: "é€£çµ¡å…ˆ *", phonePlaceholder: "010-1234-5678", deptLabel: "å­¦ç§‘ *", deptPlaceholder: "å­¦ç§‘ã‚’é¸æŠ", messageLabel: "å†…å®¹ï¼ˆä»»æ„ï¼‰", messagePlaceholder: "ç°¡å˜ãªèª¬æ˜", cancelBtn: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", submitBtn: "ç”³è«‹" },
            uz: { title: "ğŸ“‹ Maslahat", nameLabel: "Ism *", namePlaceholder: "Ism kiriting", phoneLabel: "Telefon *", phonePlaceholder: "010-1234-5678", deptLabel: "Bo'lim *", deptPlaceholder: "Bo'limni tanlang", messageLabel: "Savol", messagePlaceholder: "Qisqa tavsif", cancelBtn: "Bekor", submitBtn: "Yuborish" },
            bn: { title: "ğŸ“‹ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶", nameLabel: "à¦¨à¦¾à¦® *", namePlaceholder: "à¦¨à¦¾à¦® à¦²à¦¿à¦–à§à¦¨", phoneLabel: "à¦«à§‹à¦¨ *", phonePlaceholder: "010-1234-5678", deptLabel: "à¦¬à¦¿à¦­à¦¾à¦— *", deptPlaceholder: "à¦¬à¦¿à¦­à¦¾à¦— à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨", messageLabel: "à¦¬à¦¿à¦·à¦¯à¦¼", messagePlaceholder: "à¦¸à¦‚à¦•à§à¦·à¦¿à¦ªà§à¦¤ à¦¬à¦¿à¦¬à¦°à¦£", cancelBtn: "à¦¬à¦¾à¦¤à¦¿à¦²", submitBtn: "à¦œà¦®à¦¾" }
        };
        
        const WELCOME_MESSAGES = {
            ko: `ë°˜ê°€ì›Œìš”! ğŸ˜Š
ë™ì›ê³¼ê¸°ëŒ€ AI ì…í•™ìƒë‹´ ë„ìš°ë¯¸ì˜ˆìš”~

ì…í•™ì— ê´€í•´ ê¶ê¸ˆí•œ ê±° ë­ë“  í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!
ì„±ì , í•™ê³¼, ì¥í•™ê¸ˆ, ê¸°ìˆ™ì‚¬, ì…”í‹€ë²„ìŠ¤ ë“± ë­ë“  OK!

ğŸ’¬ ì˜ˆì‹œ) "ë‚´ì‹  5ë“±ê¸‰ì¸ë° ì–´ë–¤ í•™ê³¼ ê°ˆ ìˆ˜ ìˆì–´ìš”?"`,
            en: `Hi there! ğŸ˜Š
I'm your friendly DIST admissions helper~

Feel free to ask me anything about admissions!

ğŸ’¬ Example) "Which departments for grade 5?"`,
            zh: `ä½ å¥½å‘€ï¼ğŸ˜Š
æˆ‘æ˜¯ä¸œå›­ç§‘æŠ€å¤§å­¦çš„AIå…¥å­¦å’¨è¯¢å°åŠ©æ‰‹~

æœ‰ä»€ä¹ˆæƒ³é—®çš„å°½ç®¡é—®æˆ‘å“¦ï¼

ğŸ’¬ ä¾‹å­ï¼‰"5çº§æˆç»©èƒ½ä¸Šä»€ä¹ˆä¸“ä¸šå‘€ï¼Ÿ"`,
            vi: `ChÃ o báº¡n! ğŸ˜Š
MÃ¬nh lÃ  trá»£ lÃ½ tÆ° váº¥n tuyá»ƒn sinh DIST Ä‘Ã¢y~

Báº¡n cá»© thoáº£i mÃ¡i há»i mÃ¬nh báº¥t cá»© Ä‘iá»u gÃ¬ nhÃ©!

ğŸ’¬ VÃ­ dá»¥) "Äiá»ƒm 5 thÃ¬ em cÃ³ thá»ƒ vÃ o khoa nÃ o áº¡?"`,
            ja: `ã“ã‚“ã«ã¡ã¯ï¼ğŸ˜Š
æ±åœ’ç§‘æŠ€å¤§å­¦ã®AIå…¥å­¦ç›¸è«‡ãƒ˜ãƒ«ãƒ‘ãƒ¼ã§ã™~

å…¥å­¦ã«ã¤ã„ã¦ä½•ã§ã‚‚æ°—è»½ã«èã„ã¦ãã ã•ã„ã­ï¼

ğŸ’¬ ä¾‹ï¼‰ã€Œæˆç¸¾5ã§å…¥ã‚Œã‚‹å­¦ç§‘ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€`,
            uz: `Salom! ğŸ˜Š
Men DIST qabul bo'yicha AI yordamchiman~

Qabul haqida nimani bilmoqchi bo'lsangiz so'rang!

ğŸ’¬ Misol) "5 baho bilan qaysi mutaxassislikka kiraman?"`,
            bn: `à¦¹à§à¦¯à¦¾à¦²à§‹! ğŸ˜Š
à¦†à¦®à¦¿ DIST à¦à¦° AI à¦­à¦°à§à¦¤à¦¿ à¦¸à¦¹à¦¾à¦¯à¦¼à¦•~

à¦­à¦°à§à¦¤à¦¿ à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡ à¦¯à§‡à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¦¨!

ğŸ’¬ à¦‰à¦¦à¦¾à¦¹à¦°à¦£) "à§« à¦—à§à¦°à§‡à¦¡ à¦¦à¦¿à¦¯à¦¼à§‡ à¦•à§‹à¦¨ à¦¬à¦¿à¦­à¦¾à¦—à§‡ à¦¯à§‡à¦¤à§‡ à¦ªà¦¾à¦°à¦¬?"`
        };
        
        const ADMISSION_DATABASE = `
Dongwon Institute of Science and Technology (DIST) Admissions Information

IMPORTANT: School Name Translations
- Korean: ë™ì›ê³¼í•™ê¸°ìˆ ëŒ€í•™êµ
- English: Dongwon Institute of Science and Technology (DIST)
- Japanese: æ±åœ’ç§‘å­¦æŠ€è¡“å¤§å­¦ (NOT æ±åŸ!)
- Chinese (Simplified): ä¸œå›­ç§‘å­¦æŠ€æœ¯å¤§å­¦

# Department Recommendations by Grade Level

## Grades 1-2 (Top Tier)
- Nursing (avg 3.5) - High employment, stable career
- Early Childhood Education (avg 3.8) - 3-year program, teaching license
- Optometry (avg 4.1) - Professional license, good income

## Grades 3-4 (High Tier)
- Optometry (avg 4.1)
- Aircraft Maintenance (avg 4.5) - Technical expertise, aviation industry
- Early Childhood Education (avg 3.8)
- Sports Rehabilitation & Exercise (avg 4.0) - Growing field
- Hotel & Culinary Arts (avg 4.2) - Hands-on skills

## Grades 5-6 (Mid Tier) â˜…Recommended for International Studentsâ˜…
- Refrigeration & Air Conditioning (avg 5.0) - High demand, practical skills
- Mechatronics (avg 5.2) - Industry 4.0, automation
- Industrial Safety Management (avg 5.5) - Safety certification
- Hotel Pastry & Baking (avg 5.3) - Creative industry
- Social Welfare (avg 5.4) - Social service career
- Hair Design (avg 5.5) - Beauty industry license

## Grades 7-8 (Open Admission)
- Refrigeration & Air Conditioning - Practical technical training
- Marine Power Machinery - Shipbuilding industry
- AI Mechanical Control - Emerging technology

# Department Contacts
- Nursing: Kim Song-soon (055-370-8243, 010-4662-6209)
- Optometry: Yoon Mi-ok (055-370-8214, 010-8931-7214)
- Aircraft Maintenance: Bae Gyu-han (055-370-8318, 010-6511-5235)
- Mechatronics: Lee Hak-won (055-370-8371, 010-3680-9833)
- Refrigeration & Air Conditioning: Lee Jung-hyun (055-370-8167, 010-8569-8819)
# Admissions Office: 055-370-8226~8

# Shuttle Bus Information (Contact: 010-2504-8884)
## ìš¸ì‚°: ë‚¨êµ¬(ì‚¼ì‚°ë™,ì‹ ì •ë™), ì¤‘êµ¬(ì„±ë‚¨ë™,íƒœí™”ë™), ë™êµ¬(ì „í•˜ë™), ìš¸ì£¼êµ°(ì–¸ì–‘,ì‚¼ë‚¨ë©´)
## ìš¸ì‚° ë¶êµ¬: ì§ì ‘ ì •ë¥˜ì†Œ ì—†ìŒ â†’ íƒœí™”ë™ í˜„ëŒ€ë°±í™”ì  ë˜ëŠ” ìš¸ì‚°ì—­ ì´ìš©
## ë¶€ì‚°: í•´ìš´ëŒ€ì—­, ë™ë˜ì—­, ì„œë©´, ì‚¬ìƒí„°ë¯¸ë„
## ì–‘ì‚°: ë¬¼ê¸ˆì—­, ì–‘ì‚°í„°ë¯¸ë„, ë¶ì •ë™ ì´ë§ˆíŠ¸
## ê¹€í•´: ì¥ìœ  ì´ë§ˆíŠ¸, ê¹€í•´ì‹œì²­
## ì •ë¥˜ì†Œ ì—†ëŠ” ì§€ì—­: ê°€ê¹Œìš´ ì •ë¥˜ì†Œ ì•ˆë‚´ ë˜ëŠ” ìì°¨(ë¬´ë£Œì£¼ì°¨) ê¶Œì¥
`;

        let currentLanguage = 'ko';
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const languageBtn = document.getElementById('languageBtn');
        const languageModal = document.getElementById('languageModal');
        
        let conversationHistory = [];

        function updateUI() {
            const texts = UI_TRANSLATIONS[currentLanguage];
            document.getElementById('chatTitle').textContent = texts.chatTitle;
            userInput.placeholder = texts.inputPlaceholder;
            sendButton.textContent = texts.sendButton;
            languageBtn.textContent = texts.languageButton;
        }

        languageBtn.addEventListener('click', () => {
            languageModal.classList.add('active');
        });

        languageModal.addEventListener('click', (e) => {
            if (e.target === languageModal) {
                languageModal.classList.remove('active');
            }
        });

        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', () => {
                currentLanguage = option.dataset.lang;
                conversationHistory = [];
                updateUI();
                languageModal.classList.remove('active');
                
                document.querySelectorAll('.language-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                option.classList.add('selected');
                
                chatMessages.innerHTML = '';
                addMessage(WELCOME_MESSAGES[currentLanguage]);
            });
        });

        function formatPhoneNumbers(text) {
            text = text.replace(/(\d{3}-\d{3}-\d{4})/g, '<a href="tel:$1">ğŸ“ $1</a>');
            text = text.replace(/(\d{3}-\d{4}-\d{4})/g, '<a href="tel:$1">ğŸ“± $1</a>');
            return text;
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            if (!isUser) {
                content = formatPhoneNumbers(content);
            }
            
            contentDiv.innerHTML = content.replace(/\n/g, '<br>');
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot-message';
            loadingDiv.id = 'loading';
            loadingDiv.innerHTML = `
                <div class="message-content">
                    <span class="loading"></span>
                    <span class="loading"></span>
                    <span class="loading"></span>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeLoading() {
            const loading = document.getElementById('loading');
            if (loading) loading.remove();
        }

        async function sendToGemini(userMessage) {
            try {
                const languageInstructions = {
                    ko: 'You MUST answer ONLY in Korean (í•œêµ­ì–´). Do not mix any other languages.',
                    en: 'You MUST answer ONLY in English. Do not mix any other languages.',
                    zh: 'You MUST answer ONLY in Chinese (ä¸­æ–‡). Do not mix any other languages.',
                    vi: 'You MUST answer ONLY in Vietnamese (Tiáº¿ng Viá»‡t). Do not mix any other languages.',
                    ja: 'You MUST answer ONLY in Japanese (æ—¥æœ¬èª). Do not mix any other languages. Always write school name as æ±åœ’ç§‘å­¦æŠ€è¡“å¤§å­¦.',
                    uz: "You MUST answer ONLY in Uzbek (O'zbek tilida). Do not mix any other languages.",
                    bn: 'You MUST answer ONLY in Bengali (à¦¬à¦¾à¦‚à¦²à¦¾). Do not mix any other languages.'
                };

                const systemPrompt = `You are a friendly and warm admissions counseling chatbot for Dongwon Institute of Science and Technology (DIST).

CRITICAL LANGUAGE INSTRUCTION: ${languageInstructions[currentLanguage]}

${ADMISSION_DATABASE}

Response Rules:
1. Be warm, friendly, and approachable - use casual but polite language
2. Use emoticons appropriately (ğŸ˜Š, ğŸ‘, âœ¨, ğŸ“, ğŸ“, ğŸšŒ etc.)
3. Keep answers concise (2-4 sentences) for mobile users
4. Recommend specific departments based on student needs with encouragement
5. Always include hyphens in phone numbers (e.g., 055-370-8226)
6. End responses with helpful follow-up suggestions
7. Answer in the specified language ONLY
8. Use conversation history for context
9. When user seems worried, reassure them warmly
10. Use expressions like "ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”!", "ê±±ì • ë§ˆì„¸ìš”~" in Korean`;

                const contents = [];
                
                if (conversationHistory.length === 0) {
                    contents.push({
                        role: 'user',
                        parts: [{ text: systemPrompt + '\n\nUser Question: ' + userMessage }]
                    });
                } else {
                    contents.push({
                        role: 'user',
                        parts: [{ text: systemPrompt }]
                    });
                    
                    conversationHistory.forEach(msg => {
                        contents.push({
                            role: msg.role,
                            parts: [{ text: msg.text }]
                        });
                    });
                    
                    contents.push({
                        role: 'user',
                        parts: [{ text: userMessage }]
                    });
                }

                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: contents,
                        generationConfig: { temperature: 0.3, maxOutputTokens: 1024 }
                    })
                });

                if (!response.ok) throw new Error('API ì˜¤ë¥˜');
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                conversationHistory.push({ role: 'user', text: userMessage });
                conversationHistory.push({ role: 'model', text: aiResponse });
                
                const MAX_CONVERSATIONS = 20;
                if (conversationHistory.length >= MAX_CONVERSATIONS) {
                    const limitMessages = {
                        ko: '\n\nğŸ˜Š ìš°ì™€~ ëŒ€í™”ë¥¼ ì •ë§ ë§ì´ ë‚˜ëˆ´ë„¤ìš”!\në” ì •í™•í•œ ìƒë‹´ì„ ìœ„í•´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”~',
                        en: '\n\nğŸ˜Š Wow, we\'ve chatted a lot!\nPlease refresh the page for better responses~',
                        zh: '\n\nğŸ˜Š å“‡ï¼Œæˆ‘ä»¬èŠäº†å¥½å¤šï¼\nè¯·åˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹å“¦~',
                        vi: '\n\nğŸ˜Š Ã”i, chÃºng ta Ä‘Ã£ nÃ³i chuyá»‡n nhiá»u quÃ¡!\nHÃ£y lÃ m má»›i trang nhÃ©~',
                        ja: '\n\nğŸ˜Š ãŸãã•ã‚“ãŠè©±ã—ã¾ã—ãŸã­ï¼\nãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„~',
                        uz: '\n\nğŸ˜Š Juda ko\'p gaplashdik!\nSahifani yangilang~',
                        bn: '\n\nğŸ˜Š à¦…à¦¨à§‡à¦• à¦•à¦¥à¦¾ à¦¬à¦²à§‡à¦›à¦¿!\nà¦ªà§ƒà¦·à§à¦ à¦¾ à¦°à¦¿à¦«à§à¦°à§‡à¦¶ à¦•à¦°à§à¦¨~'
                    };
                    conversationHistory = conversationHistory.slice(-MAX_CONVERSATIONS);
                    return aiResponse + limitMessages[currentLanguage];
                }
                
                return aiResponse;
            } catch (error) {
                console.error('Error:', error);
                
                if (!GEMINI_API_KEY || GEMINI_API_KEY === 'YOUR_API_KEY_HERE') {
                    const setupMessages = {
                        ko: 'ì•—, ì•„ì§ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ì–´ìš”! ğŸ˜…\nğŸ“ 055-370-8226ìœ¼ë¡œ ì „í™”ì£¼ì„¸ìš”~',
                        en: 'Oops, setup isn\'t complete! ğŸ˜…\nPlease call ğŸ“ 055-370-8226~',
                        zh: 'å“å‘€ï¼Œè®¾ç½®è¿˜æ²¡å®Œæˆï¼ğŸ˜…\nè¯·æ‹¨æ‰“ ğŸ“ 055-370-8226~',
                        vi: 'Ã”i, chÆ°a cÃ i Ä‘áº·t xong! ğŸ˜…\nVui lÃ²ng gá»i ğŸ“ 055-370-8226~',
                        ja: 'ã¾ã è¨­å®šãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ï¼ğŸ˜…\nğŸ“ 055-370-8226 ã«ãŠé›»è©±ãã ã•ã„~',
                        uz: 'Sozlash tugallanmagan! ğŸ˜…\nğŸ“ 055-370-8226 ga qo\'ng\'iroq qiling~',
                        bn: 'à¦¸à§‡à¦Ÿà¦†à¦ª à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦¹à¦¯à¦¼à¦¨à¦¿! ğŸ˜…\nğŸ“ 055-370-8226 à¦ à¦•à¦² à¦•à¦°à§à¦¨~'
                    };
                    return setupMessages[currentLanguage];
                }
                
                const errorMessages = {
                    ko: 'ì•—, ì ê¹ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”! ğŸ˜…\nğŸ“ 055-370-8226~8ë¡œ ì „í™”ì£¼ì„¸ìš”~',
                    en: 'Oops, something went wrong! ğŸ˜…\nCall ğŸ“ 055-370-8226~8~',
                    zh: 'å“å‘€ï¼Œå‡ºäº†ç‚¹é—®é¢˜ï¼ğŸ˜…\nè¯·æ‹¨æ‰“ ğŸ“ 055-370-8226~8~',
                    vi: 'Ã”i, cÃ³ lá»—i xáº£y ra! ğŸ˜…\nHÃ£y gá»i ğŸ“ 055-370-8226~8~',
                    ja: 'å•é¡ŒãŒèµ·ãã¾ã—ãŸï¼ğŸ˜…\nğŸ“ 055-370-8226~8 ã«ãŠé›»è©±ãã ã•ã„~',
                    uz: 'Muammo yuz berdi! ğŸ˜…\nğŸ“ 055-370-8226~8 ga qo\'ng\'iroq qiling~',
                    bn: 'à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡! ğŸ˜…\nğŸ“ 055-370-8226~8 à¦ à¦•à¦² à¦•à¦°à§à¦¨~'
                };
                return errorMessages[currentLanguage];
            }
        }

        async function handleSend() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            userInput.value = '';
            sendButton.disabled = true;
            
            showLoading();
            const response = await sendToGemini(message);
            removeLoading();
            
            addMessage(response);
            sendButton.disabled = false;
        }

        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });
        
        userInput.addEventListener('focus', () => {
            setTimeout(() => {
                userInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        });

        window.visualViewport?.addEventListener('resize', () => {
            const viewportHeight = window.visualViewport.height;
            document.body.style.height = `${viewportHeight}px`;
        });

        addMessage(WELCOME_MESSAGES[currentLanguage]);
        
        // ìƒë‹´ ëª¨ë‹¬ í•¨ìˆ˜
        function openConsultModal() {
            updateConsultFormLanguage();
            document.getElementById('consultModal').classList.add('active');
        }
        
        function updateConsultFormLanguage() {
            const text = CONSULT_FORM_TEXT[currentLanguage];
            document.getElementById('consultTitle').textContent = text.title;
            document.getElementById('consultNameLabel').textContent = text.nameLabel;
            document.getElementById('consultName').placeholder = text.namePlaceholder;
            document.getElementById('consultPhoneLabel').textContent = text.phoneLabel;
            document.getElementById('consultPhone').placeholder = text.phonePlaceholder;
            document.getElementById('consultDeptLabel').textContent = text.deptLabel;
            document.getElementById('consultDeptPlaceholder').textContent = text.deptPlaceholder;
            document.getElementById('consultMessageLabel').textContent = text.messageLabel;
            document.getElementById('consultMessage').placeholder = text.messagePlaceholder;
            document.getElementById('cancelBtn').textContent = text.cancelBtn;
            document.getElementById('submitBtn').textContent = text.submitBtn;
        }
        
        function closeConsultModal() {
            document.getElementById('consultModal').classList.remove('active');
            document.getElementById('consultName').value = '';
            document.getElementById('consultPhone').value = '';
            document.getElementById('consultDept').value = '';
            document.getElementById('consultMessage').value = '';
        }
        
        function submitConsult() {
            const name = document.getElementById('consultName').value.trim();
            const phone = document.getElementById('consultPhone').value.trim();
            const dept = document.getElementById('consultDept').value;
            const message = document.getElementById('consultMessage').value.trim();
            
            if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if (!phone) { alert('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if (!dept) { alert('ê´€ì‹¬ í•™ê³¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            
            const phonePattern = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;
            if (!phonePattern.test(phone.replace(/-/g, ''))) {
                alert('ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.\nì˜ˆ: 010-1234-5678');
                return;
            }
            
            const professor = PROFESSORS[dept];
            if (!professor) { alert('í•´ë‹¹ í•™ê³¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
            
            const smsContent = encodeURIComponent(`[ë™ì›ê³¼ê¸°ëŒ€ ìƒë‹´ì‹ ì²­]\ní•™ê³¼: ${dept}\nì´ë¦„: ${name}\nì—°ë½ì²˜: ${phone}${message ? '\në¬¸ì˜: ' + message : ''}`);
            const professorPhone = professor.phone.replace(/-/g, '');
            
            window.location.href = `sms:${professorPhone}?body=${smsContent}`;
            closeConsultModal();
            
            addMessage(`âœ… ${dept} ${professor.name} êµìˆ˜ë‹˜ê»˜ ìƒë‹´ ë¬¸ìê°€ ì „ì†¡ë©ë‹ˆë‹¤.\n\në¬¸ìì•±ì—ì„œ ì „ì†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”! ğŸ˜Š`);
        }
    </script>
</body>
</html>
